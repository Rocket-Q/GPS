<!DOCTYPE html>
<html lang="zh-CN">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>位置和姿态数据显示</title>
    <script>



        // 当页面加载完成后初始化传感器
        window.addEventListener('DOMContentLoaded', () => {
            // 获取位置信息
            if ('geolocation' in navigator) {
                navigator.geolocation.watchPosition(position => {
                    updatePosition(position);
                }, errorHandler, {
                    enableHighAccuracy: true,
                    timeout: 5000,
                    maximumAge: 0
                });
            } else {
                document.getElementById('position').innerText = "不支持定位功能";
            }

            // 获取设备方向
            if ('DeviceOrientationEvent' in window) {
                window.addEventListener('deviceorientation', event => {
                    updateOrientation(event);
                });
            } else {
                document.getElementById('orientation').innerText = "不支持方向传感器";
            }

            // 获取加速度
            if ('DeviceMotionEvent' in window) {
                window.addEventListener('devicemotion', event => {
                    updateMotion(event);
                });
            } else {
                document.getElementById('motion').innerText = "不支持运动传感器";
            }
        });

        function addlog(newlog) {
            let Log = `
${newlog}, ${document.getElementById('log').innerText}`;
            //log.trim();
            document.getElementById('log').innerText = Log;
        };
        // 更新位置数据
        function updatePosition(position) {
            const data = position.coords;
            const date = new Date(position.timestamp);

            let html = `时间: ${date.toLocaleTimeString()}

经度: ${data.longitude.toFixed(6)}°
纬度: ${data.latitude.toFixed(6)}°
高度: ${data.altitude ? data.altitude.toFixed(2) + '米' : '不可用'}
精度: ${data.accuracy.toFixed(2)}米            
速度: ${data.speed ? (data.speed * 3.6).toFixed(2) + '公里/小时' : '0'}`;

            let temp = `${date.toLocaleTimeString()}, ${data.longitude.toFixed(6)}, ${data.latitude.toFixed(6)}, ${data.altitude ? data.altitude.toFixed(2) : '--'}`;
            document.getElementById('position').innerText = html;
            addlog(temp);

        }

        // 更新方向数据
        function updateOrientation(event) {
            const alpha = event.alpha ? event.alpha.toFixed(2) : "不可用";
            const beta = event.beta ? event.beta.toFixed(2) : "不可用";
            const gamma = event.gamma ? event.gamma.toFixed(2) : "不可用";

            let html = `姿态：
  α(航向): ${alpha}°
  β(俯仰): ${beta}°
  γ(滚转): ${gamma}°`;

            document.getElementById('orientation').innerText = html;
        }

        // 更新运动数据
        function updateMotion(event) {
            const acc = event.acceleration;
            const accG = event.accelerationIncludingGravity;
            const rot = event.rotationRate;

            let html = `重力加速度: 
  x = ${accG.x ? accG.x.toFixed(2) : '0'} m/s²
  y = ${accG.y ? accG.y.toFixed(2) : '0'} m/s² 
  z = ${accG.z ? accG.z.toFixed(2) : '0'} m/s²             
加速度: 
  x = ${acc.x ? acc.x.toFixed(2) : '0'} m/s²
  y = ${acc.y ? acc.y.toFixed(2) : '0'} m/s²
  z = ${acc.z ? acc.z.toFixed(2) : '0'} m/s²
角速度: 
  α = ${rot.alpha ? rot.alpha.toFixed(2) : '0'} °/s 
  β = ${rot.beta ? rot.beta.toFixed(2) : '0'} °/s 
  γ = ${rot.gamma ? rot.gamma.toFixed(2) : '0'} °/s`;

            document.getElementById('motion').innerText = html;
        }

        // 错误处理
        function errorHandler(err) {
            console.error('位置错误:', err);
            document.getElementById('position').innerText = `位置获取错误: ${err.message}`;
        }
    </script>
</head>

<body>
    <!-- 页面标题 -->
    <!-- 传感器数据展示区域 -->


    <table border="0">
        <div style="margin: 1px; padding: 1px; border-top: 1px solid #cd2626;">
            <tr>
                <td>
                    <pre id="position">正在获取数据</pre>
                    <pre id="orientation"></pre>
                </td>
                <td>
                    <pre id="motion"></pre>
                </td>
            </tr>
        </div>
    </table>



    <div style="margin: 1px; padding: 1px; border-top: 1px solid #cd2626;">日志<pre id="log"></pre>

    </div>
    <!-- 使用说明 -->

    <div style="margin: 1px; padding: 1px; border-top: 1px solid #afafaf;color: rgb(128,128, 128">
        <h3>使用说明:</h3>
        <ul>
            <li>首次使用可能需要授权位置访问权限
            <li>Mr.Q &copy; 2025
            </li>
        </ul>

    </div>

</body>

</html>